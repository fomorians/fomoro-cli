#!/usr/bin/env node

var program = require('commander');
var request = require('request');
var fs = require('fs');
var path = require('path');

var TRAIN_URL = 'http://localhost:3000/train';

program
  .action(function(confpath, args) {
    var metadata = JSON.parse(fs.readFileSync(confpath));

    options = Object.assign({}, metadata);
    options.global_step = 0;
    options.batch_size = args.batch_size || 50;
    options.epochs = args.epochs || 2000;
    options.checkpoint_epoch = args.checkpoint_epoch || 100;

    // TODO: validate options
    console.log(options);

    var relpath = options.dataset || options.model;
    var abspath = path.resolve(path.dirname(confpath), relpath);

    var req = request({
      url: TRAIN_URL,
      method: 'POST',
      headers: {
        'content-type': 'application/json'
      },
      body: JSON.stringify(options)
    }, function(err, res, body) {
      if (err) {
        console.error(err.stack);
        process.exit(1);
        return;
      }

      console.log(body);
    });
  })
  .parse(process.argv);
